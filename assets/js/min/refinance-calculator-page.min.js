"use strict";function init_range_sliders(){991<window.innerWidth&&$(".value-slider").each(function(){var e=parseFloat($(this).attr("data-min")),t=parseFloat($(this).attr("data-max")),a=(parseFloat($(this).attr("data-step")),parseFloat($(this).attr("data-value"))),n=$(this);$(this).slider({range:"min",min:e,max:t,value:a,slide:function(e,t){$(this).parents("label").find("[data-slider-target]").val(t.value).trigger("keyup").trigger("change"),$(this).find(".ui-slider-handle").text("")},create:function(e,t){var a=setInterval(function(){n.find(".ui-slider-handle").text("").attr("tabindex","-1"),clearInterval(a)},20)}})})}jQuery(document).ready(function(c){var r={currentLoan:{amount:{field:c("input[name=loanAmount]"),type:"amount",min:1,max:1e7,required:!0},interestRate:{field:c("input[name=interestRate]"),type:"percentage",min:1,max:100,required:!0},term:{field:c("#loanTerm"),type:"term",min:1,max:30,required:!0},originationMonthYear:{field:c("input[name=originationYear]"),type:"year",min:1980,max:(new Date).getFullYear(),required:!0}},newLoan:{interestRate:{field:c("input[name=newInterestRate]"),type:"percentage",min:1,max:100,required:!0},term:{field:c("#newLoanTerm"),type:"term",min:1,max:30,required:!0},cashOut:{field:c("input[name=newCashOut]"),type:"amount",min:0,max:1e7,required:!1},closingCosts:{field:c("input[name=newClosingCosts]"),type:"amount",min:0,max:1e7,required:!1}}},s={currentMonthlyPayment:{field:c("#currentMonthlyPayment"),type:"amount",trigger:["calculate"]},newMonthlyPayment:{field:c("#newMonthlyPayment"),type:"amount",trigger:["calculate"]},monthlySavings:{field:c("#monthlySavings"),type:"amountS",trigger:["calculate"]},totalSavingsFull:{field:c("#totalSavingsFull"),type:"totalSavingsFull",trigger:["calculate","chart"]},breakevent:{field:c("#breakevent"),type:"breakevent",trigger:["calculate"]},throughYear:{field:c("#throughYear"),type:"throughYear",trigger:["calculate","chart"]},totalSavings:{field:c("#totalSavings"),type:"chart",trigger:["calculate","chart"]},currentTotal:{field:c("#currentTotal"),type:"chart",trigger:["calculate","chart"],hideSymbol:1},newTotal:{field:c("#newTotal"),type:"chart",trigger:["calculate","chart"],hideSymbol:1},cashSavings:{field:c("#cashSavings"),type:"chart",trigger:["calculate","chart"]},currentPrincipalTotal:{field:c("#currentPrincipalTotal"),type:"chart",trigger:["calculate","chart"],hideSymbol:1},newPrincipalTotal:{field:c("#newPrincipalTotal"),type:"chart",trigger:["calculate","chart"],hideSymbol:1},differenceInEquity:{field:c("#differenceInEquity"),type:"chart",trigger:["calculate","chart"]}},u=29,h=0;function i(e){return void 0===e?0:Number(e.replace(/[^0-9\.]+/g,""))}function l(e,t,a,n,r){var i=Math.round(e);e=parseFloat(parseFloat(Math.abs(e)).toFixed(t)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");e=r?(i<0&&e?"-":n&&0<i?"+":"")+(a?"$":"")+e:(a?"$":"")+e;return i<0?'<span class="redText">'+e+"</span>":e}function g(e,t,a,n,r){switch(t){case"amount":e=l(e,n,a,!1,r);break;case"amountS":case"amountK":e=l(e,n,a,!0,r);break;case"percentage":i=n,e=parseFloat(parseFloat(e).toFixed(i))+(a?"%":"")}var i;return e}function o(e,t){!function(e){null==e&&(e=c(".field-error-msg"));e.siblings(".field-error-msg").remove(),e.removeClass("field-error")}(e);var a=e.val();if(t&&t.required&&""===a)n(e,"required",t);else if((a=i(a))<t.min)n(e,"min",t);else{if(!(a>t.max))return 1;n(e,"max",t)}}function n(e,t,a){var n=pageVars.err[t];"min"!==t&&"max"!==t||(n=n.replace("%s",g(a[t],a.type,!0,0,!0))),c(n='<div class="field-error-msg">'+n+"</div>").insertAfter(e),e.addClass("field-error")}function m(e){var t,a={};for(t in r)for(var n in r[t])switch(r[t][n].type){case"percentage":a[t+"_"+n]=i(r[t][n].field.val()),e&&(a[t+"_"+n]=a[t+"_"+n]/12/100);break;case"term":a[t+"_"+n]=i(r[t][n].field.val()),e&&(a[t+"_"+n]=12*a[t+"_"+n]);break;case"year":a[t+"_"+n]=r[t][n].field.val();break;default:a[t+"_"+n]=i(r[t][n].field.val())}return a}function d(){var e,t,a,n=m(!0),r={chart:new Array,breakevent:!1};r.currentMonthlyPayment=p(n.currentLoan_amount,n.currentLoan_interestRate,n.currentLoan_term),n.remainingTerm=function(e,t){var a=new Date,n=new Date(a.getFullYear(),a.getMonth(),1),a=new Array("January","February","March","April","May","June","July","August","September","October","November","December");(t=t.split(" "))[0]=Math.max(0,a.indexOf(t[0]));t=new Date(t[1],t[0]),t=new Date(n.getTime()-t.getTime()),t=12*(t.getUTCFullYear()-1970)+t.getUTCMonth();return e-t}(n.currentLoan_term,n.currentLoan_originationMonthYear),n.newLoan_amount=(e=r.currentMonthlyPayment,t=n.currentLoan_interestRate,a=n.remainingTerm,Math.max(0,e*(1-Math.pow(1+t,-a))/t)+n.newLoan_cashOut+n.newLoan_closingCosts),r.newMonthlyPayment=p(n.newLoan_amount,n.newLoan_interestRate,n.newLoan_term),r.monthlySavings=r.currentMonthlyPayment-r.newMonthlyPayment;for(var i={currentPrincipalRemaining:n.newLoan_amount-n.newLoan_cashOut-n.newLoan_closingCosts,currentPrincipalTotal:0,currentInterestTotal:0,currentTotal:0,newPrincipalRemaining:n.newLoan_amount,newPrincipalTotal:0,newInterestTotal:0,newTotal:0,cashSavings:0,differenceInEquity:0,totalSavings:0},l=1;l<=Math.max(n.remainingTerm,n.newLoan_term);l++){l<=n.remainingTerm&&(o=i.currentPrincipalRemaining*n.currentLoan_interestRate,i.currentPrincipalTotal+=r.currentMonthlyPayment-o,i.currentInterestTotal+=o,i.currentTotal+=r.currentMonthlyPayment,i.currentPrincipalRemaining-=r.currentMonthlyPayment-o);var o=i.newPrincipalRemaining*n.newLoan_interestRate;i.newPrincipalTotal+=r.newMonthlyPayment-o,i.newInterestTotal+=o,i.newTotal+=r.newMonthlyPayment,i.newPrincipalRemaining-=r.newMonthlyPayment-o,i.cashSavings=i.currentTotal-i.newTotal,i.differenceInEquity=i.currentPrincipalTotal-i.newPrincipalTotal,i.totalSavings=i.cashSavings+i.differenceInEquity,l%12==0&&r.chart.push(c.extend({},i)),!1===r.breakevent&&0<i.totalSavings&&(r.breakevent=l)}u>r.chart.length&&(u=r.chart.length-1),function(e){for(var t=[],a=c(document).width()<767,n=0;n<e.chart.length;n++)t.push([n+1,e.chart[n].totalSavings]);Highcharts.chart("refChart",{navigator:{enabled:!1},credits:{enabled:!1},chart:{type:"area",style:{fontFamily:"Poppins"},events:{}},rangeSelector:{enabled:!1},scrollbar:{enabled:!1},title:{text:""},plotOptions:{series:{marker:{enabled:!1}}},yAxis:{tickColor:"#000",tickWidth:1.5,plotLines:[{color:"#000",zIndex:10,value:30,width:1.5}],gridLineColor:"#fff",lineColor:"#000",lineWidth:1.5,title:{margin:a?10:15,text:pageVars.totalSavings,style:{color:"#222222",fontSize:a?"12px":"14px"}},offset:a?-2:-7,labels:{color:"#000",formatter:function(){return g(this.value,"amount",!0,0,!0)},style:{color:"#222222",fontSize:a?"12px":"14px"}}},xAxis:{tickColor:"#000",tickWidth:1.5,lineColor:"#000",lineWidth:1.5,gridLineColor:"#fff",title:{text:pageVars.year.plural,style:{color:"#222222",fontSize:a?"12px":"14px"}},crosshair:{width:2,color:"#8B8B8B",zIndex:10},labels:{align:"center",style:{color:"#000",fontSize:"14px"}}},series:[{allowPointSelect:!1,lineWidth:1.5,data:t,color:"#4064E4",negativeColor:"#FF5722",fillColor:"#F0F3FF",negativeFillColor:"#FFCDC0",states:{hover:{enabled:!1,lineWidth:1.5}}}],legend:{enabled:!1},tooltip:{shared:!0,useHTML:!0,formatter:function(){return u=this.x-1,clearTimeout(h),h=setTimeout(function(){f(e,"chart")},100),'<span class="tooltipTitle"><strong>'+this.x+"</strong> "+(1<this.x?pageVars.year.plural:pageVars.year.singular)+'</span><span class="tooltipText">'+pageVars.totalSavings+": "+g(this.y,"amount",!0,0,!0)+"</span>"}}})}(r),f(r,"calculate")}function p(e,t,a){return e*(t*Math.pow(t+1,a)/(Math.pow(t+1,a)-1))}function f(e,t){var a,n,r,i,l=!1;for(a in s)if(-1!=s[a].trigger.indexOf(t))switch(s[a].type){case"amount":s[a].field.html(g(e[a],"amount",!0,0,!0));break;case"amountS":l=e[a].hasOwnProperty("hideSymbol")?0:1,s[a].field.html(g(e[a],"amountS",!0,0,l));break;case"chart":l=s[a].hasOwnProperty("hideSymbol")?0:1,s[a].field.html(g(e.chart[u][a],"amountK",!0,0,l));break;case"breakevent":s[a].field.html(e.breakevent?pageVars.breakevent.replace("%s",(o=e.breakevent,i=r=n=void 0,n=Math.floor(o/12),r=o-12*n,i=1<n?pageVars.year.plural:pageVars.year.singular,o=1<r?pageVars.month.plural:pageVars.month.singular,(n?"<strong>"+n+"</strong> "+i:"")+" "+(r?"<strong>"+r+"</strong> "+o:""))):"&nbsp;");break;case"throughYear":s[a].field.html(u+1);break;case"totalSavingsFull":var o=u+1+" "+(0==u?pageVars.year.singular:pageVars.year.plural);s[a].field.html('<span class="total-savings-full-period">('+o+')</span><span class="total-savings-full-value">'+g(e.chart[u].totalSavings,"amount",!0,0,!0)+"</span>")}}init_range_sliders(),function(){var e,n={};for(e in r)for(var t in r[e])n[r[e][t].field.attr("name")]={loan:e,field:t},r[e][t].field.on("change",function(){var e,t,a;e=c(this),"year"==(t=r[n[c(this).attr("name")].loan][n[c(this).attr("name")].field]).type||(a=e.val()).length&&e.val(g(i(a),t.type,!0,"percentage"==t.type?3:2,!0)),o(c(this),r[n[c(this).attr("name")].loan][n[c(this).attr("name")].field])&&d()})}(),d();var t=c(".customRange__input"),a=c(".customRange__active"),y=c(t.attr("data-range-target")),v=parseFloat(t.attr("max"));function w(e){a.css("width",Math.min(100,Math.ceil(e/v*100))+"%")}t.on("change input",function(e){var t=i(c(this).val());y.val(l(t),0,!1,!1),w(t),"change"===e.type&&y.change()}),y.on("change",function(){var e=i(c(this).val());t.val(e),w(e)}),y.val(2e5).trigger("change"),c("input[name=originationYear]").MonthPicker({ShowIcon:!1,StartYear:i(c("input[name=originationYear]").val()),MinMonth:new Date(r.currentLoan.originationMonthYear.min,0,1),MaxMonth:new Date(r.currentLoan.originationMonthYear.max,11,31),MonthFormat:"MM yy",ShowAnim:"none",HideAnim:"none",OnAfterChooseMonth:function(e){o(c("input[name=originationYear]"),r.currentLoan.originationMonthYear)&&(c("input[name=originationYear]").MonthPicker({StartYear:new Date(e).getFullYear()}),d())}}),c(document).on("keypress",".calc__radio label",function(e){c(this).click()}),c(document).on("click","#full-report",function(e){return e.preventDefault(),window.open(c(this).attr("href")+"?report-data="+Base64.encodeURI(JSON.stringify(m(!1)))),!1})}),$(window).on("resize",function(){init_range_sliders()}),$(window).on("orientationchange",function(){init_range_sliders()},!1);