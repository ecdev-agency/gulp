"use strict";function getLocation(){return jQuery.post("https://www.googleapis.com/geolocation/v1/geolocate?key="+geolocation_vars.geoApiKey+"&v=3")}function getIpinfoLocation(){return jQuery.get("https://ipinfo.io",function(t){$(document).trigger("ipinfo_location_done",t)},"json")}var sm_user_geo_loading=!1;function sm_get_user_geolocation(){if(void 0!==geolocation_vars.visitor_country&&null!=geolocation_vars.visitor_country&&""!=geolocation_vars.visitor_country)return sm_get_user_location_details(geolocation_vars.visitor_country);var o=getCookie("geolocation");if(o)try{if(!(o=JSON.parse(o)).hasOwnProperty("country")||!o.hasOwnProperty("zip_code")||!o.hasOwnProperty("state"))throw"geolocation error"}catch(t){o=!1}if(o&&0!=o)return $(document).trigger("geolocation_received",o),o;$.when(getIpinfoLocation()).done(function(t){return sm_get_user_location_details(t.country)})}function sm_get_user_location_details(t){var e=getCookie("geolocation");if("US"!=t)return e=geolocation_vars.geoLocation,sm_user_geo_loading=!0,setCookie("geolocation",JSON.stringify(e),{expires:void 0}),$(document).trigger("geolocation_received",e),e;if(e)try{if(e=JSON.parse(e),$(document).trigger("geolocation_received",e),!e.hasOwnProperty("country")||!e.hasOwnProperty("zip_code")||!e.hasOwnProperty("state"))throw"geolocation error";return e}catch(t){e=!1}return e&&0!=e?void 0:getLocation().done(function(t){var o=new Date(Date.now()+36e5);return $.ajax({url:sm_obj.ajaxurl,method:"POST",data:{action:"sm_get_location",location:JSON.stringify(t)},success:function(t){return e={country:t.country,zip_code:t.zip_code,state_code:t.statecode,state:t.state,city:t.city,county_name:t.county_name,state_url:t.state_url},sm_user_geo_loading=!0,setCookie("geolocation",JSON.stringify(e),{expires:o}),$(document).trigger("geolocation_received",e),e}})})}function sm_get_us_user_zip(){var o=getCookie("geolocation");if(o)try{if(!(o=JSON.parse(o)).hasOwnProperty("country")||!o.hasOwnProperty("zip_code")||!o.hasOwnProperty("state"))throw"geolocation error"}catch(t){o=!1}return o}function sm_get_us_user_state(){var t=sm_get_user_geolocation();return"US"==t.country?t.state_code:""}function sm_get_us_user_state_name(){var t=sm_get_user_geolocation();return"US"==t.country?t.state:""}$(document).on("geolocation_received",function(t,o){o.hasOwnProperty("state_name")&&o.state&&($('[data-update="state_name"]').text(o.state),$('li.state_link > a, a.state_link, a[href="#state_link"]').attr("href",o.state_url))});